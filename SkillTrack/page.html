<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Learning Goals</title>
  <style>
    * {
      box-sizing: border-box;
    }
    .goal-buttons {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 30px;
  margin-bottom: 10px;
}

.add-goal-btn {
  background-color: #2c5cc5;
  color: white;
  border: none;
  padding: 12px 30px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(44, 92, 197, 0.08);
  transition: background 0.2s;
}

.add-goal-btn:hover {
  background-color: #1d3e7a;
}

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 240px;
      background-color: #ffffff;
      padding: 20px 15px;
      border-right: 1px solid #e0e0e0;
      box-shadow: 4px 0 12px rgba(0, 0, 0, 0.03);
      transition: all 0.3s ease;
    }

    .sidebar.collapsed {
      width: 60px;
    }

    .sidebar h2 {
      font-size: 22px;
      margin-bottom: 25px;
      color: #2c3e50;
      text-align: center;
      transition: opacity 0.2s;
    }

    .sidebar.collapsed h2 {
      display: none;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 16px;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      color: #333;
      cursor: pointer;
      transition: background 0.2s;
      white-space: nowrap;
    }

    .nav-item:hover {
      background-color: #f0f4ff;
    }

    .sidebar.collapsed .menu-text {
      display: none;
    }
    .sidebar.collapsed .nav-item{
      display: none;
    }

    /* Toggle Button */
    .toggle-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
      background: #2970ff;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      z-index: 99;
    }

    .main-content {
      flex: 1;
      overflow-y: auto;
      padding: 40px;
    }

    .main-box {
      background-color: white;
      border-radius: 10px;
      padding: 30px;
      max-width: 700px;
      margin: auto;
    }

    .profile-section {
      display: flex;
      align-items: center;
      margin-bottom: 30px;
    }

    .profile-pic {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      margin-right: 20px;
    }

    .upload-icon {
      position: relative;
      margin-left: -30px;
      margin-top: 40px;
      background-color: #00ff91;
      border-radius: 50%;
      padding: 6px;
      cursor: pointer;
    }

    .upload-icon img {
      width: 18px;
      height: 18px;
    }

    #fileInput {
      display: none;
    }

    .goal-box {
      margin-bottom: 30px;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
    }

    .goal-box h3 {
      margin-top: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .goal-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .tag {
      background-color: #e0ebff;
      padding: 5px 10px;
      border-radius: 5px;
      position: relative;
    }

    .tag span {
      margin-left: 8px;
      color: red;
      cursor: pointer;
      font-weight: bold;
    }

    input.goal-input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .add-goal-btn {
  background-color: #2c5cc5;
  color: white;
  border: none;
  padding: 12px 30px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(44, 92, 197, 0.08);
  transition: background 0.2s, transform 0.1s;
}

.add-goal-btn:hover {
  background-color: #1d3e7a;
  transform: scale(1.05);
}

    .add-goal-btn {
      display: block;
      margin: auto;
      margin-top: 20px;
      background-color: #2c5cc5;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }

    .delete-btn {
      background-color: transparent;
      border: none;
      color: red;
      font-size: 18px;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .sidebar {
        position: absolute;
        height: 100vh;
        z-index: 9;
      }

      .main-content {
        padding: 20px;
      }
    }
  </style>
</head>
<body>

  <!-- Toggle Button -->
  <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <h2>Menu</h2>
    <div class="nav-item"><span class="icon">üè†</span><span class="menu-text">Home</span></div>
    <div class="nav-item"><span class="icon">üìà</span><span class="menu-text">Progress</span></div>
    <div class="nav-item"><span class="icon">üéØ</span><span class="menu-text">Goals</span></div>
    <div class="nav-item"><span class="icon">üóìÔ∏è</span><span class="menu-text">Calendar</span></div>
    <div class="nav-item"><span class="icon">üì§</span><span class="menu-text">Daily Uploads</span></div>
    <div class="nav-item"><span class="icon">üî•</span><span class="menu-text">Streaks</span></div>
    <div class="nav-item"><span class="icon">‚è±Ô∏è</span><span class="menu-text">Pomodoro Timer</span></div>
    <div class="nav-item"><span class="icon">üë§</span><span class="menu-text">Profile</span></div>
    <div class="nav-item"><span class="icon">üö™</span><span class="menu-text">Logout</span></div>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <div class="main-box">
      <h1>Set Your Learning Goals</h1>
      <div class="profile-section">
        <div class="profile-pic" id="profilePic"
             style="background-image: url('https://cdn-icons-png.flaticon.com/512/149/149071.png');"></div>
        <label class="upload-icon" for="fileInput">
          <img src="https://cdn-icons-png.flaticon.com/512/747/747545.png" alt="camera" />
        </label>
        <input type="file" id="fileInput" accept="image/*" onchange="previewImage(event)">
        <div>
          <!-- <h2 style="margin: 0;">Your Name</h2> -->
           <h2 style="margin: 0;" id="userName">Your Name</h2>
          <p style="margin: 2px 0; color: #666;">Focused on continuous learning and growth</p>
        </div>
      </div>

      <!-- Goals -->
      <div id="goalContainer">
        
      </div>
      <div class="goal-buttons">
  <button class="add-goal-btn" onclick="addGoal()">+ Add Goal</button>
  <button class="add-goal-btn" id="saveGoalsBtn" onclick="saveGoals()">Save</button>
</div>
      
      <!-- <button class="add-goal-btn" onclick="addGoal()">+ Add Goal</button> -->
      <!-- <button class="add-goal-btn" id="saveGoalsBtn" onclick="saveGoals()">Save</button> -->

    </div>
  </div>

  <!-- JavaScript -->
  <script>

  //   window.addEventListener('DOMContentLoaded', async () => {
  // const email = localStorage.getItem('userEmail');
  // if (!email) return;
  // try {
  //   const res = await fetch(`http://localhost:5000/api/profile?email=${encodeURIComponent(email)}`);
  //   const data = await res.json();
  //   if (res.ok) {
  //     document.getElementById('profilePic').style.backgroundImage = `url('${data.profilePic || "https://cdn-icons-png.flaticon.com/512/149/149071.png"}')`;
  //     document.getElementById('userName').textContent = data.name || "Your Name";
  //   }
  // } catch {}
// });
window.addEventListener('DOMContentLoaded', async () => {
  const email = localStorage.getItem('userEmail');
  if (!email) return;
  // Fetch profile
  try {
    const res = await fetch(`http://localhost:5000/api/profile?email=${encodeURIComponent(email)}`);
    const data = await res.json();
    if (res.ok) {
      document.getElementById('profilePic').style.backgroundImage =
  `url('${data.profilePic ? "http://localhost:5000" + data.profilePic : "https://cdn-icons-png.flaticon.com/512/149/149071.png"}')`;

      // document.getElementById('profilePic').style.backgroundImage = `url('${data.profilePic || "https://cdn-icons-png.flaticon.com/512/149/149071.png"}')`;
      document.getElementById('userName').textContent = data.name || "Your Name";
    }
  } catch {}

  // Fetch and display goals
  try {
    const res = await fetch(`http://localhost:5000/api/goals?email=${encodeURIComponent(email)}`);
    const data = await res.json();
    if (res.ok && data.goals && data.goals.length > 0) {
      data.goals.forEach(goal => {
        addGoalBox(goal.title, goal.tags);
      });
    }
  } catch {}
});
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('collapsed');
    }

    function previewImage(event) {
      const reader = new FileReader();
      reader.onload = function () {
        document.getElementById('profilePic').style.backgroundImage = `url('${reader.result}')`;
      };
      reader.readAsDataURL(event.target.files[0]);
    }

    function handleGoalInput(event) {
      if (event.key === "Enter") {
        const input = event.target;
        const tagText = input.value.trim();
        if (tagText === "") return;

        const tag = document.createElement("div");
        tag.className = "tag";
        tag.innerHTML = `${tagText} <span onclick="this.parentElement.remove()">‚ùå</span>`;

        const tagsContainer = input.previousElementSibling;
        tagsContainer.appendChild(tag);

        input.value = "";
      }
    }

    function removeGoal(button) {
      const goalBox = button.closest(".goal-box");
      goalBox.remove();
    }

    document.querySelectorAll(".goal-input").forEach(input => {
      input.addEventListener("keypress", handleGoalInput);
    });
    function addGoalBox(title, tags = []) {
  const goalContainer = document.getElementById("goalContainer");
  const newGoalBox = document.createElement("div");
  newGoalBox.className = "goal-box";
  newGoalBox.innerHTML =
    `<h3>${title} <button class="delete-btn" onclick="removeGoal(this)">üóëÔ∏è</button></h3>
     <div class="goal-tags"></div>
     <input class="goal-input" type="text" placeholder="Add goal" />`;
  goalContainer.appendChild(newGoalBox);

  const tagsContainer = newGoalBox.querySelector(".goal-tags");
  tags.forEach(tagText => {
    const tag = document.createElement("div");
    tag.className = "tag";
    tag.innerHTML = `${tagText} <span onclick="this.parentElement.remove()">‚ùå</span>`;
    tagsContainer.appendChild(tag);
  });

  const input = newGoalBox.querySelector(".goal-input");
  input.addEventListener("keypress", handleGoalInput);
}

    // function addGoal() {
    //   const goalContainer = document.getElementById("goalContainer");

    //   const newGoalText = prompt("Enter your new goal title (e.g., Java, Python, AI):");
    //   if (!newGoalText) return;

    //   const newGoalBox = document.createElement("div");
    //   newGoalBox.className = "goal-box";
    //   newGoalBox.innerHTML =
    //     `<h3>${newGoalText} <button class="delete-btn" onclick="removeGoal(this)">üóëÔ∏è</button></h3>
    //      <div class="goal-tags"></div>
    //      <input class="goal-input" type="text" placeholder="Add goal" />`;

    //   goalContainer.appendChild(newGoalBox);

    //   const input = newGoalBox.querySelector(".goal-input");
    //   input.addEventListener("keypress", handleGoalInput);
    // }
    function addGoal() {
  const newGoalText = prompt("Enter your new goal title (e.g., Java, Python, AI):");
  if (!newGoalText) return;
  addGoalBox(newGoalText);
}

    async function saveGoals() {
  // Collect all goals and tags
  const goalBoxes = document.querySelectorAll('.goal-box');
  const goals = [];
  goalBoxes.forEach(box => {
    const title = box.querySelector('h3').childNodes[0].textContent.trim();
    const tags = [];
    box.querySelectorAll('.goal-tags .tag').forEach(tagDiv => {
      tags.push(tagDiv.childNodes[0].textContent.trim());
    });
    goals.push({ title, tags });
  });

  const email = localStorage.getItem('userEmail');
  if (!email) {
    alert('User email not found. Please login again.');
    return;
  }

  try {
    const res = await fetch('http://localhost:5000/api/goals', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, goals })
    });
    const data = await res.json();
    if (res.ok) {
      alert('Goals saved!');
      window.location.href = 'dashboard.html';
    } else {
      alert(data.error || 'Failed to save goals');
    }
  } catch {
    alert('Server error. Please try again later.');
  }
}
  </script>
</body>
</html>
