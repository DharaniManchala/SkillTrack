<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Track Progress</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #f8f9fc;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .sidebar {
      width: 220px;
      background-color: #ffffff;
      padding: 20px 15px;
      border-right: 1px solid #e0e0e0;
      box-shadow: 4px 0 12px rgba(0, 0, 0, 0.03);
      position: relative;
      z-index: 10;
      min-height: 100vh;
    }
    .sidebar.hidden { transform: translateX(-100%); position: absolute; }
    .sidebar h2 { font-size: 22px; margin-bottom: 25px; color: #2c3e50; text-align: center; }
    .nav-item {
      display: flex; align-items: center; gap: 12px; font-size: 16px;
      padding: 12px; margin-bottom: 10px; border-radius: 8px; color: #333;
      cursor: pointer; transition: background 0.2s;
    }
    .nav-item:hover { background-color: #2970ff22; }
    .nav-icon { font-size: 18px; }
    .toggle-btn {
      position: absolute; top: 20px; left: 20px; font-size: 22px;
      background: #2970ff; color: white; border: none; border-radius: 50%;
      padding: 7px 11px; cursor: pointer; z-index: 99;
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 2px 8px rgba(44, 92, 197, 0.08);
    }
    .toggle-btn:hover { background: #1d3e7a; transform: scale(1.08);}
    .main-content {
      flex: 1; padding: 32px 0; display: flex; justify-content: center; align-items: flex-start; width: 100%;
    }
    .container {
      background: white; border-radius: 18px; padding: 2.2rem 2.5rem;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      max-width: 980px; width: 100%;
      margin: 0 auto;
    }
    h2 { margin-bottom: 2rem; padding-top: 0.5rem; font-size: 2rem;}
    h3 { margin-bottom: 1.2rem; margin-top: 1.2rem; font-size: 1.2rem;}
    .section { margin-bottom: 2rem; }
    .progress-card {
      background: #f1f5ff;
      border-radius: 14px;
      box-shadow: 0 2px 8px #2970ff22;
      border: 1px solid #2970ff22;
      padding: 1.2rem 1rem;
      margin-bottom: 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }
    .progress-card .goal-title {
      font-size: 1.1rem;
      font-weight: bold;
      color: #2970ff;
    }
    .progress-card .goal-status {
      font-size: 1.2rem;
      font-weight: bold;
      margin-left: 8px;
    }
    .progress-card .goal-date {
      font-size: 0.95rem;
      color: #555;
    }
    .progress-card .goal-progress {
      font-size: 1.5rem;
      font-weight: bold;
      color: #1d3e7a;
    }
    .calendar-controls {
      display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 0.7rem;
    }
    .calendar-btn {
      background: #2970ff;
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 2px 8px rgba(44, 92, 197, 0.08);
    }
    .calendar-btn:hover { background: #1d3e7a; transform: scale(1.08);}
    #calendarMonth { font-weight: bold; font-size: 1.1rem; color: #2970ff; }
    .calendar {
      display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; text-align: center; margin-top: 1rem;
      margin-bottom: 1.2rem;
    }
    .calendar div {
      padding: 0.5rem; border-radius: 50%; cursor: pointer; transition: background 0.2s;
      font-size: 16px;
    }
    .calendar .highlight { background-color: #2970ff; color: white; }
    .calendar .today { border: 2px solid #2970ff; }
    .days-completed {
      background: #e0f7fa;
      color: #2970ff;
      font-weight: bold;
      border-radius: 8px;
      padding: 0.7rem 1rem;
      margin-bottom: 1rem;
      margin-top: 1rem;
      text-align: center;
      font-size: 16px;
    }
    @media (max-width: 900px) {
      .container { padding: 1.2rem 0.5rem;}
      .main-content { padding: 10px 0;}
    }
    @media (max-width: 600px) {
      .sidebar { width: 100vw; min-width: 0; }
      .container { padding: 0.5rem 0.2rem;}
      h2 { font-size: 1.2rem;}
    }
  </style>
</head>
<body>
  <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>
  <div class="sidebar" id="sidebar">
    <h2>Menu</h2>
    <div class="nav-item"><span class="nav-icon">üè†</span> Home</div>
    <div class="nav-item"><span class="nav-icon">üìà</span> Progress</div>
    <div class="nav-item"><span class="nav-icon">üéØ</span> Goals</div>
    <div class="nav-item"><span class="nav-icon">üóìÔ∏è</span> Calendar</div>
    <div class="nav-item"><span class="nav-icon">üì§</span> Daily Uploads</div>
    <div class="nav-item"><span class="nav-icon">üî•</span> Streaks</div>
    <div class="nav-item"><span class="nav-icon">‚è±Ô∏è</span> Pomodoro Timer</div>
    <div class="nav-item"><span class="nav-icon">üë§</span> Profile</div>
    <div class="nav-item"><span class="nav-icon">üö™</span> Logout</div>
  </div>
  <div class="main-content">
    <div class="container">
      <h2>Track Progress</h2>
      <div class="section">
        <h3>Aspirations</h3>
        <div id="progressCards"></div>
        <div class="days-completed" id="daysCompleted"></div>
        <div class="calendar-controls">
          <button class="calendar-btn" id="prevMonthBtn">&lt;</button>
          <span id="calendarMonth"></span>
          <button class="calendar-btn" id="nextMonthBtn">&gt;</button>
        </div>
        <div class="calendar" id="calendar"></div>
      </div>
      <div style="text-align:center; margin-top:30px;">
  <a href="streaks.html">
    <button class="btn" style="background:#2970ff;color:white;padding:12px 32px;border-radius:8px;font-size:18px;cursor:pointer;border:none;">
      Next &rarr;
    </button>
  </a>
</div>
    </div>
    <!-- Add this before the closing </div> of .container -->

  </div>
  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('hidden');
    }

    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let selectedDate = null;

    function renderCalendar(month, year) {
      const calendarDiv = document.getElementById('calendar');
      calendarDiv.innerHTML = '';
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const firstDay = new Date(year, month, 1).getDay();
      const weekdays = ['S','M','T','W','T','F','S'];
      weekdays.forEach(d => {
        const cell = document.createElement('div');
        cell.textContent = d;
        cell.style.fontWeight = 'bold';
        calendarDiv.appendChild(cell);
      });
      for (let i = 0; i < firstDay; i++) {
        calendarDiv.appendChild(document.createElement('div'));
      }
      for (let day = 1; day <= daysInMonth; day++) {
        const cell = document.createElement('div');
        cell.textContent = day;
        cell.style.cursor = 'pointer';
        const today = new Date();
        const cellDate = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
        if (selectedDate === cellDate) {
          cell.classList.add('highlight');
        } else if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
          cell.classList.add('today');
        }
        cell.onclick = () => {
          selectedDate = cellDate;
          renderCalendar(month, year);
          onDateClick(year, month, day);
        };
        calendarDiv.appendChild(cell);
      }
      document.getElementById('calendarMonth').textContent =
        `${new Date(year, month).toLocaleString('default', { month: 'long' })} ${year}`;
    }

    document.getElementById('prevMonthBtn').onclick = () => {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar(currentMonth, currentYear);
    };
    document.getElementById('nextMonthBtn').onclick = () => {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar(currentMonth, currentYear);
    };

    function showProgressCards(progress, dateStr) {
      const cardsDiv = document.getElementById('progressCards');
      cardsDiv.innerHTML = `<h3>Progress till ${dateStr}</h3>`;
      if (!progress || progress.length === 0) {
        cardsDiv.innerHTML += '<div>You haven\'t started anything yet!</div>';
        return;
      }
      progress.forEach(goal => {
        let status = '‚ö†Ô∏è Not Started';
        if (goal.progress >= 100) status = '‚úÖ Completed';
        else if (goal.progress > 0) status = 'üî• In Progress';
        let lastDate = '--';
        if (goal.subtopics && goal.subtopics.length) {
          lastDate = goal.subtopics.map(sub => sub.lastDate).filter(Boolean).sort().pop() || '--';
        }
        cardsDiv.innerHTML += `
          <div class="progress-card">
            <div class="goal-title">${goal.goal}</div>
            <div>
              <span class="goal-progress">${goal.progress}%</span>
              <span class="goal-status">${status}</span>
            </div>
            <div class="goal-date">Last updated: ${lastDate}</div>
          </div>
        `;
      });
    }

    function showDaysCompleted(days, dateStr) {
      const daysDiv = document.getElementById('daysCompleted');
      daysDiv.innerHTML = `You completed work on <span style="color:#1d3e7a;">${days}</span> day(s) till <span style="color:#1d3e7a;">${dateStr}</span>.`;
    }

    window.addEventListener('DOMContentLoaded', async () => {
      const today = new Date();
      selectedDate = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
      renderCalendar(today.getMonth(), today.getFullYear());
      const email = localStorage.getItem('userEmail');
      if (!email) return;
      try {
        const res = await fetch(`http://localhost:5000/api/progress?email=${encodeURIComponent(email)}&until=${selectedDate}`);
        const data = await res.json();
        showProgressCards(data.progress, selectedDate);
        if (data.daysCompleted !== undefined) {
          showDaysCompleted(data.daysCompleted, selectedDate);
        }
      } catch {
        document.getElementById('progressCards').innerHTML = '<div>Error loading progress.</div>';
      }
    });

    async function onDateClick(year, month, day) {
      const email = localStorage.getItem('userEmail');
      const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
      try {
        const res = await fetch(`http://localhost:5000/api/progress?email=${encodeURIComponent(email)}&until=${dateStr}`);
        const data = await res.json();
        showProgressCards(data.progress, dateStr);
        if (data.daysCompleted !== undefined) {
          showDaysCompleted(data.daysCompleted, dateStr);
        }
      } catch {
        document.getElementById('progressCards').innerHTML = '<div>Error loading progress.</div>';
      }
    }
  </script>
</body>
</html>